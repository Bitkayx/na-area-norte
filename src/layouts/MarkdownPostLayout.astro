---
import Layout from "@layouts/Layout.astro";
import { formatDate } from "../utils/dateUtils";
import { getCollection } from "astro:content";

const { frontmatter } = Astro.props;
const { title, pubDate, description, author, image, tags } = frontmatter;
const allPosts = await getCollection("blog");
const tagCounts: Record<string, number> = {};
allPosts.forEach((post: any) => {
  if (post.data.tags) {
    post.data.tags.forEach((tag: string) => {
      tagCounts[tag] = (tagCounts[tag] || 0) + 1;
    });
  }
});
---

<Layout title={title}>
  <article class="mt-10">
    <header class="mb-8">
      <h1 class="text-4xl font-light mb-4">{title}</h1>
      <p class="text-slate-600 dark:text-slate-400 italic text-lg mb-6">
        {description}
      </p>
      {
        image && (
          <img
            src={image.url}
            alt={image.alt}
            class="w-full max-w-max h-100 rounded-lg mb-6"
          />
        )
      }
      <div class="text-sm text-slate-500 dark:text-slate-500 space-y-1">
        <p>Fecha de publicacion: {formatDate(pubDate)}</p>
        <p>Autor: {author}</p>
      </div>
    </header>

    {
      tags && tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-8">
          {tags.map((tag: string) => (
            <a
              href={`/tags/${tag}`}
              class="px-3 py-1 text-sm border border-slate-300 dark:border-slate-600 rounded-full text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors duration-200"
            >
              {tag}
            </a>
          ))}
        </div>
      )
    }

    <div class="prose prose-slate dark:prose-invert max-w-none">
      <slot />
    </div>
  </article>
</Layout>
